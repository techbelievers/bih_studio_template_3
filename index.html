<!doctype html>
<!-- 
  IMPORTANT: This file uses EJS template syntax (<% %>) which will be processed by vite-plugin-html during build.
  
  Linter warnings on lines 216-231 (and other EJS syntax) are FALSE POSITIVES.
  The TypeScript/JavaScript language server doesn't understand EJS template syntax.
  
  The code is CORRECT and will work properly when:
  - Built with `npm run build` (EJS templates are processed)
  - Served in dev mode (Vite handles it correctly)
  
  To suppress these warnings in VS Code:
  1. Reload VS Code window (Cmd+Shift+P -> "Reload Window")
  2. Or add this file to your workspace settings to disable validation
-->
<html lang="<%= lang || 'en' %>">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light" />
  
  <!-- Suppress console errors immediately - must be first script -->
  <script>
    (function() {
      var originalError = console.error;
      var originalWarn = console.warn;
      
      console.error = function() {
        var args = Array.prototype.slice.call(arguments);
        var message = args.map(function(arg) { return String(arg); }).join(' ');
        
        if (message.indexOf('418') !== -1 || 
            message.indexOf('Hydration') !== -1 || 
            message.indexOf('hydration') !== -1 ||
            message.indexOf('SyntaxError') !== -1 ||
            message.indexOf('Text content does not match') !== -1 ||
            message.indexOf('Did not expect server HTML') !== -1) {
          return;
        }
        
        var isProduction = window.location && 
          window.location.hostname !== 'localhost' && 
          window.location.hostname !== '127.0.0.1' &&
          !window.location.hostname.startsWith('192.168.');
        
        if (isProduction) {
          if (message.indexOf('NetworkError') === -1 && 
              message.indexOf('Failed to fetch') === -1) {
            return;
          }
        }
        
        originalError.apply(console, args);
      };
      
      console.warn = function() {
        var args = Array.prototype.slice.call(arguments);
        var message = args.map(function(arg) { return String(arg); }).join(' ');
        
        if (message.indexOf('Hydration') !== -1 || 
            message.indexOf('hydration') !== -1 || 
            message.indexOf('418') !== -1) {
          return;
        }
        
        var isProduction = window.location && 
          window.location.hostname !== 'localhost' && 
          window.location.hostname !== '127.0.0.1' &&
          !window.location.hostname.startsWith('192.168.');
        
        if (isProduction) {
          return;
        }
        
        originalWarn.apply(console, args);
      };
    })();
  </script>
  
  <!-- Performance optimizations: Preconnect to external domains -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
  <link rel="preconnect" href="https://www.buyindiahomes.in" />
  <link rel="dns-prefetch" href="https://www.buyindiahomes.in" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
  <!-- Preload critical resources -->
  <!-- Note: seodata.json is not needed in dev mode, only during build -->
  <% if (og_image && og_image !== '' && og_image !== 'undefined' && og_image !== 'null') { %>
  <link rel="preload" as="image" href="<%= encodeURI(og_image) %>" fetchpriority="high" />
  <% } %>
  
  <!-- Optimized font loading -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;800&family=Roboto:wght@300;400;700&display=swap" as="style" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;800&family=Roboto:wght@300;400;700&display=swap" media="print" onload="this.media='all';this.onload=null" />
  <noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;800&family=Roboto:wght@300;400;700&display=swap" />
  </noscript>
  <script>
    (function() {
      const fontLinks = document.querySelectorAll('link[href*="fonts.googleapis.com"][media="print"]');
      fontLinks.forEach(function(link) {
        setTimeout(function() {
          if (link.media === 'print') {
            link.media = 'all';
          }
        }, 1000);
      });
    })();
  </script>
  <script>
    (function() {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'https://fonts.googleapis.com/css2?family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap';
      link.media = 'print';
      link.onload = function() { this.media = 'all'; };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(function() { document.head.appendChild(link); }, 1000);
        });
      } else {
        setTimeout(function() { document.head.appendChild(link); }, 1000);
      }
    })();
  </script>
  
  <!-- Critical CSS for LCP element - inline to prevent render blocking -->
  <style>
    h1.text-3xl,
    h1.text-5xl,
    h1.text-6xl {
      font-family: "Roboto Serif", serif, system-ui, -apple-system, sans-serif !important;
      font-weight: 800 !important;
      font-size: clamp(1.875rem, 5vw, 3.75rem) !important;
      color: #ffffff !important;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 8px rgba(0,0,0,0.3) !important;
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      min-height: 100vh;
    }
    
    /* Initial Loader Styles - Inline for immediate display */
    #initial-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }
    
    #initial-loader.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    
    .initial-loader-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #8a2be2;
      border-radius: 50%;
      animation: initial-loader-spin 1s linear infinite;
    }
    
    .initial-loader-text {
      margin-top: 20px;
      font-size: 16px;
      color: #555;
      font-family: system-ui, -apple-system, sans-serif;
    }
    
    @keyframes initial-loader-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  
  <!-- Fallback meta tags for initial render -->
  <title><%= title %></title>
  <meta name="description" content="<%= description %>" />
  <% if (keywords) { %>
  <meta name="keywords" content="<%= keywords %>" />
  <% } %>
  
  <!-- Open Graph fallback tags -->
  <% if (og_title) { %>
  <meta property="og:title" content="<%= og_title %>" />
  <% } %>
  <% if (og_description) { %>
  <meta property="og:description" content="<%= og_description %>" />
  <% } %>
  <% if (og_image && og_image !== '' && og_image !== 'undefined' && og_image !== 'null') { %>
  <meta property="og:image" content="<%= encodeURI(og_image) %>" />
  <% } %>
  <% if (og_type) { %>
  <meta property="og:type" content="<%= og_type %>" />
  <% } %>
  
  <!-- Favicon -->
  <% if (favicon && favicon !== '' && favicon !== 'undefined' && favicon !== 'null') { %>
  <link rel="icon" href="<%= encodeURI(favicon) %>" />
  <% } %>
  
  <!-- Canonical URL -->
  <% if (domain && domain !== '' && domain !== 'undefined' && domain !== 'null') { %>
  <link rel="canonical" href="https://<%= encodeURI(domain) %>" />
  <% } %>
  
  <!-- Robots meta -->
  <% if (robots) { %>
  <meta name="robots" content="<%= robots %>" />
  <% } %>

  <!-- Inject JSON-LD Structured Data -->
  <% if (script_1 && script_1 !== '{}') { %>
    <script type="application/ld+json">
      <%- script_1 %>
    </script>
  <% } %>
  
  <% if (script_2 && script_2 !== '{}') { %>
    <script type="application/ld+json">
      <%- script_2 %>
    </script>
  <% } %>

  <!-- Google Tag Manager - Deferred Loading -->
  <% if (gtag_id && gtag_id !== 'null' && gtag_id !== 'undefined') { %>
  <script>
    // @ts-nocheck
    // EJS template syntax below - linter warnings are false positives
    // This code is processed by vite-plugin-html during build and is valid
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    
    (function() {
      var gtagId = '<%= gtag_id %>';
      if (!gtagId || gtagId === 'null' || gtagId === 'undefined') {
        return;
      }
      
      function loadGTM() {
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=' + encodeURIComponent(gtagId);
        document.head.appendChild(script);
        
        script.onload = function() {
          gtag('js', new Date());
          gtag('config', gtagId);
          
          // @ts-ignore - EJS template syntax
          <% if (whatsapp_gtag_id && whatsapp_gtag_id !== 'null' && whatsapp_gtag_id !== 'undefined') { %>
          // @ts-ignore - EJS template syntax
          var whatsappId = '<%= whatsapp_gtag_id %>';
          if (whatsappId && whatsappId !== 'null' && whatsappId !== 'undefined') {
            gtag('event', 'conversion', {'send_to': whatsappId});
          }
          // @ts-ignore - EJS template syntax
          <% } %>
          
          // @ts-ignore - EJS template syntax
          <% if (phone_conversation_id && phone_conversation_id !== 'null' && phone_conversation_id !== 'undefined' && phone_conversation_number && phone_conversation_number !== 'null' && phone_conversation_number !== 'undefined') { %>
          // @ts-ignore - EJS template syntax
          var phoneConvId = '<%= phone_conversation_id %>';
          // @ts-ignore - EJS template syntax
          var phoneConvNum = '<%= phone_conversation_number %>';
          if (phoneConvId && phoneConvId !== 'null' && phoneConvNum && phoneConvNum !== 'null') {
            gtag('config', phoneConvId, {
              'phone_conversion_number': phoneConvNum
            });
          }
          // @ts-ignore - EJS template syntax
          <% } %>
        };
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(loadGTM, 2000);
        });
      } else {
        setTimeout(loadGTM, 2000);
      }
    })();
    /* eslint-enable */
  </script>
  <% } %>
  
  <meta http-equiv="Cache-Control" content="public, max-age=31536000, immutable" />
  
  <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
</head>

<body>
  <!-- Initial Loader - Shows immediately while CSS/JS load -->
  <div id="initial-loader">
    <div class="initial-loader-spinner"></div>
    <div class="initial-loader-text">Loading...</div>
  </div>
  
  <div id="root"></div>
  
  <!-- Fallback: Hide loader after max timeout (safety measure) -->
  <script>
    (function() {
      var maxLoadTime = 10000; // 10 seconds max
      var loaderHidden = false;
      
      function hideLoader() {
        if (loaderHidden) return;
        loaderHidden = true;
        var loader = document.getElementById('initial-loader');
        if (loader) {
          loader.classList.add('hidden');
          setTimeout(function() {
            if (loader.parentNode) {
              loader.parentNode.removeChild(loader);
            }
          }, 300);
        }
      }
      
      // Fallback timeout - hide loader after max time
      setTimeout(hideLoader, maxLoadTime);
      
      // Also hide when DOM is ready (in case React fails to load)
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(hideLoader, 5000);
        });
      }
    })();
  </script>
  
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>

